<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Products page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>



<div th:replace="~{blocks/navbar :: navbar}"></div>


  <div class="container-fluid">
      <div class="btn-group" sec:authorize="hasAuthority('ADMIN')" >
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin: 30px">
              Add product
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <form class="px-4 py-3" th:action="@{/products/add}" th:object="${product}" method="post">
                  <div class="form-group">
                      <input type="hidden" placeholder="email@example.com" th:field="*{id}">
                  </div>
                  <div class="form-group">
                      <label for="exampleDropdownFormTitle">Title</label>
                      <input type="text" class="form-control" id="exampleDropdownFormTitle" placeholder="title" th:field="*{title}">
                  </div>
                  <div class="form-group">
                      <label for="exampleDropdownFormPassword1">Description</label>
                      <input type="text" class="form-control" id="exampleDropdownFormPassword1" placeholder="description" th:field="*{description}">
                  </div>
                  <div class="form-group">
                      <label for="exampleDropdownFormPassword2">Price</label>
                      <input type="number" class="form-control" id="exampleDropdownFormPassword2" placeholder="price" th:field="*{price}">
                  </div>
                  <button type="submit" class="btn btn-primary">Add Product</button>
              </form>
          </div>


      </div>
      <div class="btn-group">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="filter" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin: 30px">
              Filter products
          </button>
          <div class="dropdown-menu" aria-labelledby="filter">
              <form th:action="@{/products}" method="get">
                  <input type="text" name="filterByTitle" th:value="${param.filterByTitle != null ? param.filterByTitle : ''}" placeholder="filter by word">
                  <input type="number" name="minPrice" th:value="${param.minPrice != null ? param.minPrice : ''}" placeholder="min price">
                  <input type="number" name="maxPrice" th:value="${param.maxPrice != null ? param.maxPrice : ''}" placeholder="max price">
                  <button type="submit" class="btn btn-primary"> Filter </button>
              </form>
          </div>
      </div>

    <div class="row">
          <div class="card" style="margin: 30px; width: 18rem;" th:each="prod: ${products}">
              <div class="card-body">
                  <h5 class="card-title" th:text="${prod.title}" ></h5>
                  <p class="card-text" th:text="${prod.description}"></p>
                  <p th:text="${prod.price} + ' KZT'"></p>
                  <a th:href="@{/products/{id}(id=${prod.id})}" class="btn btn-secondary"> Go to </a>
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="edit_prod" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Edit
                  </button>
                  <div class="dropdown-menu" aria-labelledby="edit_prod">
                          <form class="px-4 py-3" th:action="@{/products/edit}" method="post">
                              <input type="hidden" name="ed_id" th:value="${prod.id}">
                              <input type="text" name="ed_title" placeholder="new title" th:value="${prod.title}">
                              <input type="text" name="ed_desc" placeholder="new description" th:value="${prod.description}">
                              <input type="number" name="ed_price" placeholder="new price" th:value="${prod.price}">
                              <button type="submit" class="btn btn-primary">Update</button>
                          </form>
                  </div>
                  <form th:action="@{/products/delete}" method="post">
                      <input type="hidden" name="del_id" th:value="${prod.id}">
                      <button type="submit" class="btn btn-danger"> Delete </button>
                  </form>
              </div>
          </div>
    </div>
<!--      <div class="row">-->
<!--          <div class="card" style="margin: 30px; width: 18rem;" th:each="prod_of_top3: ${top3}">-->
<!--              <div class="card-body">-->
<!--                  <h5 class="card-title" th:text="${prod_of_top3.title}" ></h5>-->
<!--                  <p class="card-text" th:text="${prod_of_top3.description}"></p>-->
<!--                  <p th:text="${prod_of_top3.price} + ' KZT'"></p>-->
<!--                  <a th:href="@{/products/{id}(id=${prod_of_top3.id})}" class="btn btn-secondary"> Go to </a>-->
<!--              </div>-->
<!--          </div>-->
<!--      </div>-->
  </div>
    <nav aria-label="Page navigation">
        <ul class="pagination">

            <li class="page-item"><a class="page-link" th:href="@{/products?page=0}">1</a></li>
            <li class="page-item"><a class="page-link" th:href="@{/products?page=1}">2</a></li>
            <li class="page-item"><a class="page-link" th:href="@{/products?page=2}">3</a></li>
            <!-- Add more page links here as needed -->

        </ul>
    </nav>

<div th:replace="~{blocks/footer :: footer}"></div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>